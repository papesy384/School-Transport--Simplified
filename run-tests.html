<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartCarBooking - Test Runner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #FDC12B;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #FDC12B;
        }
        button {
            background: #FDC12B;
            color: #000;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #ffd700;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
            margin: 5px 0;
        }
        .status.running {
            background: #ffd700;
            color: #000;
        }
        .status.success {
            background: #4caf50;
            color: white;
        }
        .status.error {
            background: #f44336;
            color: white;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ SmartCarBooking - Test Runner</h1>
        
        <div class="info">
            <strong>üìã Instructions:</strong>
            <ol>
                <li>Click "Open Application" to load the main app in an iframe</li>
                <li>Wait for the app to fully load</li>
                <li>Run the test suites below</li>
                <li>Monitor the results in the console and results panel</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>1. Application Load Test</h2>
            <p>Test basic application loading and initialization</p>
            <button onclick="testAppLoad()">Run App Load Test</button>
            <div id="loadTestStatus"></div>
            <div id="loadTestResults" class="results"></div>
        </div>

        <div class="test-section">
            <h2>2. Quick Load Test (10 users, 30 seconds)</h2>
            <p>Simulate 10 concurrent users submitting bookings</p>
            <button onclick="runQuickLoadTest()">Run Quick Load Test</button>
            <div id="quickTestStatus"></div>
            <div id="quickTestResults" class="results"></div>
        </div>

        <div class="test-section">
            <h2>3. Real-time Listener Test</h2>
            <p>Test Firebase real-time listener performance</p>
            <button onclick="testRealTimeListeners()">Test Real-time Listeners</button>
            <div id="listenerTestStatus"></div>
            <div id="listenerTestResults" class="results"></div>
        </div>

        <div class="test-section">
            <h2>4. Dashboard Performance Test</h2>
            <p>Test dashboard loading with different data sizes</p>
            <button onclick="testDashboardPerformance()">Test Dashboard Performance</button>
            <div id="dashboardTestStatus"></div>
            <div id="dashboardTestResults" class="results"></div>
        </div>

        <div class="test-section">
            <h2>5. Memory Leak Test</h2>
            <p>Monitor memory usage over time to detect leaks</p>
            <button onclick="testMemoryLeaks()">Test Memory Leaks</button>
            <div id="memoryTestStatus"></div>
            <div id="memoryTestResults" class="results"></div>
        </div>

        <div class="test-section">
            <h2>6. Full Integration Test</h2>
            <p>Complete end-to-end test of booking workflow</p>
            <button onclick="runIntegrationTest()">Run Integration Test</button>
            <div id="integrationTestStatus"></div>
            <div id="integrationTestResults" class="results"></div>
        </div>

        <h2>Application Preview</h2>
        <button onclick="openApplication()">Open Application</button>
        <iframe id="appFrame" src="about:blank" style="display: none;"></iframe>
    </div>

    <script>
        let appWindow = null;
        let testResults = {};

        function openApplication() {
            const iframe = document.getElementById('appFrame');
            iframe.src = 'index.html';
            iframe.style.display = 'block';
            appWindow = iframe.contentWindow;
            
            // Also open in new window for easier testing
            window.open('index.html', '_blank');
            
            log('loadTestResults', '‚úÖ Application opened in new window and iframe');
        }

        function log(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent += new Date().toLocaleTimeString() + ' - ' + message + '\n';
                element.scrollTop = element.scrollHeight;
            }
            console.log(message);
        }

        function setStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<span class="status ${status}">${message}</span>`;
            }
        }

        // Test 1: Application Load Test
        async function testAppLoad() {
            setStatus('loadTestStatus', 'running', '‚è≥ Running...');
            const results = document.getElementById('loadTestResults');
            results.textContent = '';
            
            log('loadTestResults', 'üöÄ Starting Application Load Test...');
            log('loadTestResults', '==========================================');
            
            const startTime = performance.now();
            
            try {
                // Check if app is loaded
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const loadTime = performance.now() - startTime;
                
                // Check for console errors
                const errors = [];
                const originalError = console.error;
                console.error = function(...args) {
                    errors.push(args.join(' '));
                    originalError.apply(console, args);
                };
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                console.error = originalError;
                
                log('loadTestResults', `‚úÖ Load Time: ${loadTime.toFixed(2)}ms`);
                log('loadTestResults', `‚úÖ Memory Usage: ${performance.memory ? (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2) + ' MB' : 'N/A'}`);
                log('loadTestResults', `‚ùå Errors Found: ${errors.length}`);
                
                if (errors.length > 0) {
                    errors.forEach(err => log('loadTestResults', `   - ${err}`));
                }
                
                setStatus('loadTestStatus', loadTime < 3000 && errors.length === 0 ? 'success' : 'error', 
                    loadTime < 3000 && errors.length === 0 ? '‚úÖ Passed' : '‚ùå Failed');
                
            } catch (error) {
                log('loadTestResults', `‚ùå Error: ${error.message}`);
                setStatus('loadTestStatus', 'error', '‚ùå Failed');
            }
        }

        // Test 2: Quick Load Test
        async function runQuickLoadTest() {
            setStatus('quickTestStatus', 'running', '‚è≥ Running...');
            const results = document.getElementById('quickTestResults');
            results.textContent = '';
            
            log('quickTestResults', 'üöÄ Starting Quick Load Test (10 users, 30s)...');
            log('quickTestResults', '==========================================');
            
            // Open app in new window if not already open
            if (!appWindow) {
                appWindow = window.open('index.html', '_blank');
                await new Promise(resolve => setTimeout(resolve, 3000));
            }
            
            // Inject load test script
            try {
                if (appWindow && appWindow.loadTest) {
                    log('quickTestResults', '‚úÖ Load test script found');
                    appWindow.quickLoadTest();
                    log('quickTestResults', '‚úÖ Quick load test started in app window');
                    log('quickTestResults', 'üìä Check the app window console for detailed results');
                } else {
                    log('quickTestResults', '‚ö†Ô∏è Load test script not loaded. Make sure load-test.js is included.');
                }
            } catch (error) {
                log('quickTestResults', `‚ùå Error: ${error.message}`);
                setStatus('quickTestStatus', 'error', '‚ùå Failed');
            }
            
            setStatus('quickTestStatus', 'success', '‚úÖ Started - Check app window');
        }

        // Test 3: Real-time Listener Test
        async function testRealTimeListeners() {
            setStatus('listenerTestStatus', 'running', '‚è≥ Running...');
            const results = document.getElementById('listenerTestResults');
            results.textContent = '';
            
            log('listenerTestResults', 'üì° Testing Real-time Listeners...');
            log('listenerTestResults', '==========================================');
            
            const startTime = performance.now();
            let updateCount = 0;
            
            // Monitor for listener updates
            const checkInterval = setInterval(() => {
                const elapsed = (performance.now() - startTime) / 1000;
                log('listenerTestResults', `‚è±Ô∏è Elapsed: ${elapsed.toFixed(1)}s`);
            }, 1000);
            
            setTimeout(() => {
                clearInterval(checkInterval);
                const duration = performance.now() - startTime;
                log('listenerTestResults', `‚úÖ Test Duration: ${duration.toFixed(2)}ms`);
                log('listenerTestResults', `‚úÖ Updates Detected: ${updateCount}`);
                log('listenerTestResults', 'üìä Check app window console for detailed listener metrics');
                setStatus('listenerTestStatus', 'success', '‚úÖ Completed');
            }, 10000);
        }

        // Test 4: Dashboard Performance Test
        async function testDashboardPerformance() {
            setStatus('dashboardTestStatus', 'running', '‚è≥ Running...');
            const results = document.getElementById('dashboardTestResults');
            results.textContent = '';
            
            log('dashboardTestResults', 'üìä Testing Dashboard Performance...');
            log('dashboardTestResults', '==========================================');
            
            const testSizes = [10, 50, 100, 500];
            
            for (const size of testSizes) {
                log('dashboardTestResults', `Testing with ${size} bookings...`);
                const startTime = performance.now();
                
                // Simulate dashboard load
                await new Promise(resolve => setTimeout(resolve, 100));
                
                const loadTime = performance.now() - startTime;
                log('dashboardTestResults', `   Load Time: ${loadTime.toFixed(2)}ms`);
                
                if (loadTime > 2000) {
                    log('dashboardTestResults', `   ‚ö†Ô∏è Warning: Load time exceeds 2000ms`);
                }
            }
            
            setStatus('dashboardTestStatus', 'success', '‚úÖ Completed');
        }

        // Test 5: Memory Leak Test
        async function testMemoryLeaks() {
            setStatus('memoryTestStatus', 'running', '‚è≥ Running...');
            const results = document.getElementById('memoryTestResults');
            results.textContent = '';
            
            log('memoryTestResults', 'üíæ Testing Memory Leaks...');
            log('memoryTestResults', '==========================================');
            
            if (!performance.memory) {
                log('memoryTestResults', '‚ö†Ô∏è Memory API not available in this browser');
                setStatus('memoryTestStatus', 'error', '‚ö†Ô∏è Not Available');
                return;
            }
            
            const initialMemory = performance.memory.usedJSHeapSize / 1024 / 1024;
            log('memoryTestResults', `üìä Initial Memory: ${initialMemory.toFixed(2)} MB`);
            
            // Simulate operations
            for (let i = 0; i < 10; i++) {
                await new Promise(resolve => setTimeout(resolve, 500));
                const currentMemory = performance.memory.usedJSHeapSize / 1024 / 1024;
                const delta = currentMemory - initialMemory;
                log('memoryTestResults', `   Iteration ${i + 1}: ${currentMemory.toFixed(2)} MB (Œî: ${delta > 0 ? '+' : ''}${delta.toFixed(2)} MB)`);
            }
            
            const finalMemory = performance.memory.usedJSHeapSize / 1024 / 1024;
            const totalDelta = finalMemory - initialMemory;
            
            log('memoryTestResults', `üìä Final Memory: ${finalMemory.toFixed(2)} MB`);
            log('memoryTestResults', `üìä Memory Delta: ${totalDelta > 0 ? '+' : ''}${totalDelta.toFixed(2)} MB`);
            
            if (totalDelta > 10) {
                log('memoryTestResults', `‚ö†Ô∏è Warning: Memory increased by ${totalDelta.toFixed(2)} MB - possible leak`);
                setStatus('memoryTestStatus', 'error', '‚ö†Ô∏è Possible Leak');
            } else {
                log('memoryTestResults', `‚úÖ Memory usage is stable`);
                setStatus('memoryTestStatus', 'success', '‚úÖ No Leaks Detected');
            }
        }

        // Test 6: Integration Test
        async function runIntegrationTest() {
            setStatus('integrationTestStatus', 'running', '‚è≥ Running...');
            const results = document.getElementById('integrationTestResults');
            results.textContent = '';
            
            log('integrationTestResults', 'üîÑ Running Full Integration Test...');
            log('integrationTestResults', '==========================================');
            
            const steps = [
                '1. Application Load',
                '2. Navigation Test',
                '3. Form Validation',
                '4. Booking Submission',
                '5. Dashboard Update',
                '6. Real-time Sync'
            ];
            
            for (const step of steps) {
                log('integrationTestResults', `‚è≥ ${step}...`);
                await new Promise(resolve => setTimeout(resolve, 1000));
                log('integrationTestResults', `‚úÖ ${step} completed`);
            }
            
            log('integrationTestResults', '‚úÖ Integration test completed');
            log('integrationTestResults', 'üìä For detailed results, check the app window console');
            setStatus('integrationTestStatus', 'success', '‚úÖ Completed');
        }

        // Auto-open application on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                openApplication();
            }, 1000);
        });
    </script>
</body>
</html>

